{"version":3,"file":"message_recipients_autocomplete_es5.js","names":["get_users_data","data","objects","map","elem","value","username","id","get_groups_data","title","MessageRecipientsTags","input","data_extract_func","url","blacklist","tagName","type","Error","tagify","request_controller","Tagify","whitelist","on","_onInputHandler","bind","AbortController","event","detail","settings","length","loading","dropdown","hide","call","abort","fetch","signal","then","response","json","res","filter","includes","splice","show","JSON","parse","forEach","$","attr","name","appendTo","disabled"],"sources":["message_recipients_autocomplete.js"],"sourcesContent":["function get_users_data(data) {\n    return data.objects.map((elem) => {\n        return {value: elem.username, id: elem.id};\n    });\n}\n\nfunction get_groups_data(data) {\n    return data.objects.map((elem) => {\n        return {value: elem.title, id: elem.id};\n    });\n}\n\nclass MessageRecipientsTags {\n    constructor(input, data_extract_func, url, blacklist = []) {\n        if (input.tagName !== 'INPUT' || input.type !== 'text') {\n            throw Error('Base element should be <input type=\"text\">');\n        }\n        this.input = input;\n        this.tagify = null;\n        this.data_extract_func = data_extract_func;\n        this.url = url;\n        this.blacklist = blacklist;\n        this.request_controller = null;\n    }\n\n    init() {\n        this.tagify = new Tagify(this.input, {whitelist: [], blacklist: this.blacklist});\n        this.tagify.on('input', this._onInputHandler.bind(this));\n        this.request_controller = new AbortController();\n    }\n\n\n    _onInputHandler(event) {\n        const value = event.detail.value;\n        this.tagify.settings.whitelist.length = 0;\n\n        this.tagify.loading(true).dropdown.hide.call(this.tagify);\n        this.request_controller.abort();\n        this.request_controller = new AbortController();\n\n        fetch(this.url + value, {signal:this.request_controller.signal}).then(response =>\n            response.json()\n                .then(this.data_extract_func)\n                .then(res => {\n                    res = res.filter(elem => {\n                        if (!(this.blacklist.includes(elem.value))) {\n                            return elem;\n                        }\n                    });\n                    this.tagify.settings.whitelist.splice(0, res.length, ...res);\n                    this.tagify.loading(false).dropdown.show.call(this.tagify, value);\n                }));\n    }\n\n    fixOutputValue() {\n        if (this.input.value !== '') {\n            JSON.parse(this.input.value).filter(elem => 'id' in elem).forEach((elem) => {\n                $('<input>').attr({\n                    type: 'hidden',\n                    id: 'foo',\n                    name: this.input.name,\n                    value: elem.id\n                }).appendTo('form');\n            });\n        }\n        this.input.disabled = true;\n    }\n}\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,SAASA,cAAT,CAAwBC,IAAxB,EAA8B;EAC1B,OAAOA,IAAI,CAACC,OAAL,CAAaC,GAAb,CAAiB,UAACC,IAAD,EAAU;IAC9B,OAAO;MAACC,KAAK,EAAED,IAAI,CAACE,QAAb;MAAuBC,EAAE,EAAEH,IAAI,CAACG;IAAhC,CAAP;EACH,CAFM,CAAP;AAGH;;AAED,SAASC,eAAT,CAAyBP,IAAzB,EAA+B;EAC3B,OAAOA,IAAI,CAACC,OAAL,CAAaC,GAAb,CAAiB,UAACC,IAAD,EAAU;IAC9B,OAAO;MAACC,KAAK,EAAED,IAAI,CAACK,KAAb;MAAoBF,EAAE,EAAEH,IAAI,CAACG;IAA7B,CAAP;EACH,CAFM,CAAP;AAGH;;IAEKG,qB;EACF,+BAAYC,KAAZ,EAAmBC,iBAAnB,EAAsCC,GAAtC,EAA2D;IAAA,IAAhBC,SAAgB,uEAAJ,EAAI;;IAAA;;IACvD,IAAIH,KAAK,CAACI,OAAN,KAAkB,OAAlB,IAA6BJ,KAAK,CAACK,IAAN,KAAe,MAAhD,EAAwD;MACpD,MAAMC,KAAK,CAAC,4CAAD,CAAX;IACH;;IACD,KAAKN,KAAL,GAAaA,KAAb;IACA,KAAKO,MAAL,GAAc,IAAd;IACA,KAAKN,iBAAL,GAAyBA,iBAAzB;IACA,KAAKC,GAAL,GAAWA,GAAX;IACA,KAAKC,SAAL,GAAiBA,SAAjB;IACA,KAAKK,kBAAL,GAA0B,IAA1B;EACH;;;;WAED,gBAAO;MACH,KAAKD,MAAL,GAAc,IAAIE,MAAJ,CAAW,KAAKT,KAAhB,EAAuB;QAACU,SAAS,EAAE,EAAZ;QAAgBP,SAAS,EAAE,KAAKA;MAAhC,CAAvB,CAAd;MACA,KAAKI,MAAL,CAAYI,EAAZ,CAAe,OAAf,EAAwB,KAAKC,eAAL,CAAqBC,IAArB,CAA0B,IAA1B,CAAxB;MACA,KAAKL,kBAAL,GAA0B,IAAIM,eAAJ,EAA1B;IACH;;;WAGD,yBAAgBC,KAAhB,EAAuB;MAAA;;MACnB,IAAMrB,KAAK,GAAGqB,KAAK,CAACC,MAAN,CAAatB,KAA3B;MACA,KAAKa,MAAL,CAAYU,QAAZ,CAAqBP,SAArB,CAA+BQ,MAA/B,GAAwC,CAAxC;MAEA,KAAKX,MAAL,CAAYY,OAAZ,CAAoB,IAApB,EAA0BC,QAA1B,CAAmCC,IAAnC,CAAwCC,IAAxC,CAA6C,KAAKf,MAAlD;MACA,KAAKC,kBAAL,CAAwBe,KAAxB;MACA,KAAKf,kBAAL,GAA0B,IAAIM,eAAJ,EAA1B;MAEAU,KAAK,CAAC,KAAKtB,GAAL,GAAWR,KAAZ,EAAmB;QAAC+B,MAAM,EAAC,KAAKjB,kBAAL,CAAwBiB;MAAhC,CAAnB,CAAL,CAAiEC,IAAjE,CAAsE,UAAAC,QAAQ;QAAA,OAC1EA,QAAQ,CAACC,IAAT,GACKF,IADL,CACU,KAAI,CAACzB,iBADf,EAEKyB,IAFL,CAEU,UAAAG,GAAG,EAAI;UAAA;;UACTA,GAAG,GAAGA,GAAG,CAACC,MAAJ,CAAW,UAAArC,IAAI,EAAI;YACrB,IAAI,CAAE,KAAI,CAACU,SAAL,CAAe4B,QAAf,CAAwBtC,IAAI,CAACC,KAA7B,CAAN,EAA4C;cACxC,OAAOD,IAAP;YACH;UACJ,CAJK,CAAN;;UAKA,8BAAI,CAACc,MAAL,CAAYU,QAAZ,CAAqBP,SAArB,EAA+BsB,MAA/B,+BAAsC,CAAtC,EAAyCH,GAAG,CAACX,MAA7C,4BAAwDW,GAAxD;;UACA,KAAI,CAACtB,MAAL,CAAYY,OAAZ,CAAoB,KAApB,EAA2BC,QAA3B,CAAoCa,IAApC,CAAyCX,IAAzC,CAA8C,KAAI,CAACf,MAAnD,EAA2Db,KAA3D;QACH,CAVL,CAD0E;MAAA,CAA9E;IAYH;;;WAED,0BAAiB;MAAA;;MACb,IAAI,KAAKM,KAAL,CAAWN,KAAX,KAAqB,EAAzB,EAA6B;QACzBwC,IAAI,CAACC,KAAL,CAAW,KAAKnC,KAAL,CAAWN,KAAtB,EAA6BoC,MAA7B,CAAoC,UAAArC,IAAI;UAAA,OAAI,QAAQA,IAAZ;QAAA,CAAxC,EAA0D2C,OAA1D,CAAkE,UAAC3C,IAAD,EAAU;UACxE4C,CAAC,CAAC,SAAD,CAAD,CAAaC,IAAb,CAAkB;YACdjC,IAAI,EAAE,QADQ;YAEdT,EAAE,EAAE,KAFU;YAGd2C,IAAI,EAAE,MAAI,CAACvC,KAAL,CAAWuC,IAHH;YAId7C,KAAK,EAAED,IAAI,CAACG;UAJE,CAAlB,EAKG4C,QALH,CAKY,MALZ;QAMH,CAPD;MAQH;;MACD,KAAKxC,KAAL,CAAWyC,QAAX,GAAsB,IAAtB;IACH"}