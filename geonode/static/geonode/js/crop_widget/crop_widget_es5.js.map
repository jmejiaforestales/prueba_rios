{"version":3,"file":"crop_widget_es5.js","names":["IDS_VALUT","SEND_B_ID","CANCEL_B_ID","OK_B_ID","DISMISS_B_ID","GRAIN_WRAP_ID","FILE_INPUT_ID","WORKSPACE_ID","WORKSPACE_CONTAINER_ID","MODAL_OVERLAY_ID","FILE_LABEL_ID","ThumbnailService","document_id","get_path","base64_url","formData","FormData","append","_b64toBlob","url","location","origin","String","$","ajax","data","type","contentType","processData","headers","_getCookie","success","reload","error","Error","name","value","document","cookie","parts","split","length","pop","shift","image_element","callback","thumbnail_url","src","b64Data","sliceSize","byteCharacters","atob","byteArrays","offset","slice","byteNumbers","Array","i","charCodeAt","byteArray","Uint8Array","push","Blob","CssManager","dom_elem_id","removeClass","addClass","val","DomBuilder","widget_grain","wrap","grain_wrapper","prepend","workspace_html","body","_create_flow_buttons","CropTask","dom_builder","css_manager","data_service","previous_image","cropper","Cropper","aspectRatio","crop","event","image_src","create_workspace","on","load_start_image","bind","dismiss_current_image","apply_current_image","cancel_cropping","send_cropped_image","file_event","window","File","FileReader","FileList","target","files","file","fr","onload","e","destroy","attr","result","onloadend","init_cropper","change_modal_visibility","readAsDataURL","_clear_input","h","height","w","width","getCroppedCanvas","toDataURL","makeImvisible","makeVisible","set_previous_image","postThumbnail","CropWidget","element","prefetch_image","tagName","service","init","undefined","getThumbnail"],"sources":["crop_widget.js"],"sourcesContent":["const IDS_VALUT = {\n    SEND_B_ID: 'id_crop_save_button',\n    CANCEL_B_ID: 'id_crop_cancel_button',\n    OK_B_ID: 'id_crop_ok_button',\n    DISMISS_B_ID: 'id_crop_dismiss_button',\n    GRAIN_WRAP_ID: 'id_crop_entry',\n    FILE_INPUT_ID: 'id_crop_file',\n    WORKSPACE_ID: 'id_crop_modal_workspace',\n    WORKSPACE_CONTAINER_ID: 'id_crop-modal-container',\n    MODAL_OVERLAY_ID: 'id_crop-modal-overlay',\n    FILE_LABEL_ID: 'id_crop-file-label'\n}\n\n\nclass ThumbnailService {\n\n    constructor(document_id, get_path) {\n        this.document_id = document_id;\n        this.get_path = get_path;\n    }\n\n    postThumbnail(base64_url) {\n        const formData = new FormData();\n        formData.append(\"img\", this._b64toBlob(base64_url), 'blob.png');\n        const url = location.origin + '/base/' + String(this.document_id) + '/thumbnail_upload';\n        $.ajax({\n            url: url,\n            data: formData,\n            type: 'POST',\n            contentType: false,\n            processData: false,\n            headers: {\n                \"X-CSRFToken\": this._getCookie('csrftoken')\n            },\n            success: () => {\n                location.reload();\n            },\n            error: () => {\n                throw Error('Cannot upload new thumbnail');\n            }\n        });\n    }\n\n    _getCookie(name) {\n        const value = \"; \" + document.cookie;\n        const parts = value.split(\"; \" + name + \"=\");\n        if (parts.length === 2) {\n            return parts.pop().split(\";\").shift();\n        }\n    }\n\n    getThumbnail(image_element, callback = null) {\n        const url = location.origin + this.get_path + String(this.document_id);\n        return $.ajax({\n            url: url,\n            type: 'GET',\n            contentType: false,\n            processData: false,\n            headers: {\n                \"X-CSRFToken\": this._getCookie('csrftoken')\n            },\n            success: (data) => {\n                if (data && data.thumbnail_url) {\n                    image_element.src = data.thumbnail_url;\n                } else {\n                    image_element.src = '/static/geonode/img/missing_thumb.png';\n                }\n                if (callback !== null) {\n                    callback();\n                }\n            },\n            error: () => {\n                image_element.src = '/static/geonode/img/missing_thumb.png';\n            }\n        });\n\n    }\n\n    _b64toBlob(b64Data, contentType, sliceSize = 512) {\n        contentType = contentType || '';\n        b64Data = b64Data.split(',')[1];\n\n        const byteCharacters = atob(b64Data);\n        const byteArrays = [];\n\n        for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {\n            const slice = byteCharacters.slice(offset, offset + sliceSize);\n\n            const byteNumbers = new Array(slice.length);\n            for (let i = 0; i < slice.length; i++) {\n                byteNumbers[i] = slice.charCodeAt(i);\n            }\n\n            const byteArray = new Uint8Array(byteNumbers);\n\n            byteArrays.push(byteArray);\n        }\n\n        return new Blob(byteArrays, {type: contentType});\n    }\n}\n\nclass CssManager {\n\n    makeVisible(dom_elem_id) {\n        $('#' + dom_elem_id).removeClass('invisible');\n    }\n\n    makeImvisible(dom_elem_id) {\n        $('#' + dom_elem_id).addClass('invisible');\n    }\n\n    change_modal_visibility() {\n        if ($('#' + IDS_VALUT.FILE_INPUT_ID).val()) {\n            $('#' + IDS_VALUT.WORKSPACE_CONTAINER_ID).removeClass('invisible');\n            $('#' + IDS_VALUT.MODAL_OVERLAY_ID).removeClass('invisible');\n        } else {\n            $('#' + IDS_VALUT.WORKSPACE_CONTAINER_ID).addClass('invisible');\n            $('#' + IDS_VALUT.MODAL_OVERLAY_ID).addClass('invisible');\n        }\n    }\n}\n\nclass DomBuilder {\n    // class too manage building required dom to display cropper\n\n    constructor(widget_grain) {\n        this.widget_grain = widget_grain;\n        $(this.widget_grain).wrap(() => `<div id=${IDS_VALUT.GRAIN_WRAP_ID} class=crop-widget></div>`);\n        $(this.widget_grain).wrap(() => ``);\n\n        this.grain_wrapper = $('#' + IDS_VALUT.GRAIN_WRAP_ID);\n        this.grain_wrapper.append(`<div id=${IDS_VALUT.MODAL_OVERLAY_ID} class=\"crop-modal-overlay invisible\"></div>`);\n        this.grain_wrapper.prepend(`<div class=\"thumbnail-title\">Thumbnail</div>`);\n\n    }\n\n    _create_flow_buttons() {\n        this.grain_wrapper.append(`<input type=file id=${IDS_VALUT.FILE_INPUT_ID} name=files class=crop-input /> `);\n        this.grain_wrapper.append(`<label id=${IDS_VALUT.FILE_LABEL_ID} for=${IDS_VALUT.FILE_INPUT_ID} class=\"btn btn-default crop-input-label\">Choose file</label>`);\n        this.grain_wrapper.append(`<button type=button id=${IDS_VALUT.SEND_B_ID} class=\\\"btn btn-default invisible\\\">Save</button><button type=button id=${IDS_VALUT.CANCEL_B_ID} class=\"btn btn-default invisible\">Cancel</button>`);\n\n    }\n\n    create_workspace() {\n        const workspace_html = `\n                              <div id=${IDS_VALUT.WORKSPACE_CONTAINER_ID} class=\"crop-modal-container invisible\">                                  \n                                  <img id=${IDS_VALUT.WORKSPACE_ID} class=\"crop-modal-workspace\">                                      \n                                  <button type=button id=${IDS_VALUT.OK_B_ID} class=\"btn btn-default\">OK</button><button type=button id=${IDS_VALUT.DISMISS_B_ID} class=\"btn btn-default\">Dismiss</button>                                      \n                              </div>`;\n\n\n        $(document.body).append(workspace_html);\n        this._create_flow_buttons();\n\n    }\n\n}\n\nclass CropTask {\n\n    constructor(dom_builder, css_manager, data_service) {\n        this.dom_builder = dom_builder;\n        this.css_manager = css_manager;\n        this.previous_image = null;\n        this.data_service = data_service;\n    }\n\n    init_cropper() {\n        this.cropper = new Cropper($('#' + IDS_VALUT.WORKSPACE_ID)[0], {\n            aspectRatio: 4 / 3,\n            crop(event) {\n            },\n        });\n    }\n\n    set_previous_image(image_src) {\n        this.previous_image = image_src;\n    }\n\n    init() {\n        this.dom_builder.create_workspace();\n        $('#' + IDS_VALUT.FILE_INPUT_ID).on('change', this.load_start_image.bind(this));\n        $('#' + IDS_VALUT.DISMISS_B_ID).on('click', this.dismiss_current_image.bind(this));\n        $('#' + IDS_VALUT.OK_B_ID).on('click', this.apply_current_image.bind(this));\n\n        $('#' + IDS_VALUT.CANCEL_B_ID).on('click', this.cancel_cropping.bind(this));\n        $('#' + IDS_VALUT.SEND_B_ID).on('click', this.send_cropped_image.bind(this));\n        this.previous_image = this.dom_builder.widget_grain.src;\n    }\n\n    load_start_image(file_event) {\n        if (window.File && window.FileReader && window.FileList && window.Blob) {\n\n            if (file_event.target.files.length) {\n                const file = file_event.target.files[0];\n                const fr = new FileReader();\n\n                fr.onload = (e) => {\n                    if (this.cropper) {\n                        this.cropper.destroy();\n                    }\n                    $('#' + IDS_VALUT.WORKSPACE_ID).attr('src', e.target.result);\n\n                }\n                fr.onloadend = (e) => {\n                    this.init_cropper();\n                    this.css_manager.change_modal_visibility();\n                };\n                fr.readAsDataURL(file);\n\n\n            }\n        } else {\n            throw Error('FileAPI is not supported');\n        }\n    }\n\n    _clear_input() {\n        $('#' + IDS_VALUT.FILE_INPUT_ID).val('');\n    }\n\n    dismiss_current_image() {\n        this._clear_input();\n        this.cropper.destroy();\n        this.css_manager.change_modal_visibility();\n\n    }\n\n    apply_current_image() {\n        const h = this.dom_builder.widget_grain.height;\n        const w = this.dom_builder.widget_grain.width;\n        $(this.dom_builder.widget_grain).attr('src', this.cropper.getCroppedCanvas({\n            width: 400,\n        }).toDataURL());\n        $(this.dom_builder.widget_grain).attr('height', h);\n        $(this.dom_builder.widget_grain).attr('width', w);\n        this.css_manager.makeImvisible(IDS_VALUT.FILE_LABEL_ID);\n        this.css_manager.makeImvisible(IDS_VALUT.FILE_INPUT_ID);\n        this.css_manager.makeVisible(IDS_VALUT.SEND_B_ID);\n        this.css_manager.makeVisible(IDS_VALUT.CANCEL_B_ID);\n        this.cropper.destroy();\n        this._clear_input();\n        this.css_manager.change_modal_visibility();\n    }\n\n    cancel_cropping() {\n        $(this.dom_builder.widget_grain).attr('src', this.previous_image);\n        this._clear_input();\n        this.css_manager.makeImvisible(IDS_VALUT.CANCEL_B_ID);\n        this.css_manager.makeImvisible(IDS_VALUT.SEND_B_ID);\n        this.css_manager.makeVisible(IDS_VALUT.FILE_INPUT_ID);\n        this.css_manager.makeVisible(IDS_VALUT.FILE_LABEL_ID);\n    }\n\n    send_cropped_image() {\n        this.set_previous_image(this.dom_builder.widget_grain.src);\n        this.data_service.postThumbnail(this.previous_image)\n        this.css_manager.makeVisible(IDS_VALUT.FILE_INPUT_ID);\n        this.css_manager.makeImvisible(IDS_VALUT.SEND_B_ID);\n        this.css_manager.makeImvisible(IDS_VALUT.CANCEL_B_ID);\n    }\n\n\n}\n\n\nclass CropWidget {\n\n    /**\n     *\n     * @param element: img html DOM element, widget grain and final destination\n     * @param document_id id of resource. is used to build get and post requests\n     * @param get_path: api endpoint path to get current thumbnail\n     * @param prefetch_image: in case current/previous thumbnail is not API accessible provide its static url\n     *\n     */\n    constructor(element, document_id, get_path, prefetch_image = null) {\n        this.element = element;\n        if (this.element.tagName !== 'IMG') {\n            throw Error('Base element should be <img>');\n        }\n        this.dom_builder = new DomBuilder(this.element);\n        this.css_manager = new CssManager();\n        this.service = new ThumbnailService(document_id, get_path);\n        this.crop = null;\n        this.prefetch_image = prefetch_image;\n    }\n\n    init() {\n        this.crop = new CropTask(this.dom_builder, this.css_manager, this.service);\n        if (this.prefetch_image === '') {\n            this.element.src = '/static/geonode/img/missing_thumb.png';\n            this.crop.init();\n        } else if (this.prefetch_image === null || this.prefetch_image === undefined) {\n            this.service.getThumbnail(this.element, this.crop.init.bind(this.crop));\n        } else {\n            this.element.src = this.prefetch_image;\n            this.crop.init();\n        }\n    }\n}\n\n\n"],"mappings":"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"}